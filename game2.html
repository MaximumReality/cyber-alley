<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maximum Reality: Cyber Alley</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; position: fixed; width: 100%; height: 100%; }
        #gameCanvas { display: block; width: 100vw; height: 100vh; }
        
        /* UI OVERLAYS */
        .ui-layer { position: absolute; top: 20px; left: 20px; color: #0ff; text-shadow: 0 0 10px #0ff; z-index: 10; pointer-events: none; }
        #status { font-size: 18px; margin-top: 5px; }
        
        /* LOADER & START BUTTON */
        #overlay-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 100;
        }
        #loader-container { width: 200px; height: 10px; border: 1px solid #0ff; padding: 2px; }
        #loader-bar { width: 0%; height: 100%; background: #0ff; }
        #start-btn { 
            display: none; background: transparent; border: 2px solid #0ff; 
            color: #0ff; padding: 15px 30px; font-size: 20px; cursor: pointer;
            box-shadow: 0 0 15px #0ff;
        }
    </style>
</head>
<body>
    <div id="overlay-screen">
        <div id="loader-container"><div id="loader-bar"></div></div>
        <button id="start-btn" onclick="startGame()">CONNECT TO REALITY</button>
    </div>

    <div class="ui-layer">
        <div id="scoreDisplay">SCORE: 0</div>
        <div id="status">INITIALIZING...</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const BASE_URL = "https://maximumreality.github.io/cyber-alley/";

// 1. ASSET LIST
const toLoad = ['gg-bg.png', 'building-a.png', 'building-b.png', 'building-c.png', 'floor.png'];
const playerSprites = ['Lori-run.png', 'Lori-run2.png', 'Lori-run3.png', 'Azul-run.png', 'Azul-run2.png', 'Azul-run3.png', 'Mochkil.png', 'Mochkil2.png'];
const assets = {};
let loadedCount = 0;

// 2. PHYSICS & STARS
const GROUND_HEIGHT = 100; // Height of the floor from the bottom
let frame = 0;
let gameState = 'LOADING';
let score = 0;
let jumpHeight = 0;
let yVelocity = 0;
let isJumping = false;

const stars = Array.from({ length: 50 }, () => ({
    x: Math.random() * 2000,
    y: Math.random() * 300,
    size: Math.random() * 2
}));

// 3. LOAD ENGINE
function load() {
    const all = [...toLoad, ...playerSprites];
    all.forEach(src => {
        assets[src] = new Image();
        assets[src].onload = () => {
            loadedCount++;
            document.getElementById('loader-bar').style.width = (loadedCount / all.length * 100) + "%";
            if (loadedCount === all.length) {
                document.getElementById('loader-container').style.display = 'none';
                document.getElementById('start-btn').style.display = 'block';
                document.getElementById('status').innerText = "SYSTEM READY";
            }
        };
        assets[src].src = BASE_URL + src;
    });
}

function startGame() {
    document.getElementById('overlay-screen').style.display = 'none';
    gameState = 'PLAYING';
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Background Color
    ctx.fillStyle = "#1a0033";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Stars (Behind Everything)
    ctx.fillStyle = "#fff";
    stars.forEach(s => {
        let sx = (s.x - (frame * 0.5)) % canvas.width;
        if (sx < 0) sx += canvas.width;
        ctx.fillRect(sx, s.y, s.size, s.size);
    });

    // Floor (Anchored to Bottom)
    if (assets['floor.png'] && assets['floor.png'].complete) {
        for (let i = 0; i < (canvas.width / 50) + 2; i++) {
            ctx.drawImage(assets['floor.png'], (-(frame * 6) % 50) + (i * 50), canvas.height - GROUND_HEIGHT, 50, GROUND_HEIGHT);
        }
    }

    // Characters
    if (gameState === 'PLAYING') {
        frame++;
        if (isJumping) {
            jumpHeight -= yVelocity;
            yVelocity += 1.2;
            if (jumpHeight <= 0) { jumpHeight = 0; isJumping = false; }
        }
    }

    // Simple Draw for Lori (Testing Position)
    const loriImg = assets['Lori-run.png'];
    if (loriImg && loriImg.complete) {
        ctx.drawImage(loriImg, 50, canvas.height - GROUND_HEIGHT - 100 - jumpHeight, 80, 100);
    }

    requestAnimationFrame(draw);
}

function jump() {
    if (gameState === 'PLAYING' && !isJumping) {
        isJumping = true;
        yVelocity = -20;
    }
}

window.addEventListener('touchstart', (e) => { if(gameState === 'PLAYING') jump(); });
window.addEventListener('mousedown', (e) => { if(gameState === 'PLAYING') jump(); });

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);

resize();
load();
draw();
</script>
</body>
</html>
